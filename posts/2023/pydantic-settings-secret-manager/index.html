<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Pydantic Settings with AWS Secrets Manager | Amin Alaee</title><meta name=keywords content="python,pydantic,aws,secrets manager"><meta name=description content="Intro If you are already familiar with Pydantic, one of the useful components of Pydantic is the Settings Management. This will allow you to read settings variables from different sources and parse and validate them into class(es) using Pydantic.
Let&rsquo;s see a minimal example. First we need to set up the variable:
$ export API_KEY=xxx And then we can read it into the Settings class with:
from pydantic import BaseSettings class Settings(BaseSettings): api_key: str print(Settings()."><meta name=author content="Amin"><link rel=canonical href=https://aminalaee.dev/posts/2023/pydantic-settings-secret-manager/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://aminalaee.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://aminalaee.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://aminalaee.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://aminalaee.dev/apple-touch-icon.png><link rel=mask-icon href=https://aminalaee.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-MV427T1Z9X"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MV427T1Z9X",{anonymize_ip:!1})}</script><meta property="og:title" content="Pydantic Settings with AWS Secrets Manager"><meta property="og:description" content="Intro If you are already familiar with Pydantic, one of the useful components of Pydantic is the Settings Management. This will allow you to read settings variables from different sources and parse and validate them into class(es) using Pydantic.
Let&rsquo;s see a minimal example. First we need to set up the variable:
$ export API_KEY=xxx And then we can read it into the Settings class with:
from pydantic import BaseSettings class Settings(BaseSettings): api_key: str print(Settings()."><meta property="og:type" content="article"><meta property="og:url" content="https://aminalaee.dev/posts/2023/pydantic-settings-secret-manager/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-26T16:53:06+01:00"><meta property="article:modified_time" content="2023-01-26T16:53:06+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Pydantic Settings with AWS Secrets Manager"><meta name=twitter:description content="Intro If you are already familiar with Pydantic, one of the useful components of Pydantic is the Settings Management. This will allow you to read settings variables from different sources and parse and validate them into class(es) using Pydantic.
Let&rsquo;s see a minimal example. First we need to set up the variable:
$ export API_KEY=xxx And then we can read it into the Settings class with:
from pydantic import BaseSettings class Settings(BaseSettings): api_key: str print(Settings()."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://aminalaee.dev/posts/"},{"@type":"ListItem","position":3,"name":"Pydantic Settings with AWS Secrets Manager","item":"https://aminalaee.dev/posts/2023/pydantic-settings-secret-manager/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Pydantic Settings with AWS Secrets Manager","name":"Pydantic Settings with AWS Secrets Manager","description":"Intro If you are already familiar with Pydantic, one of the useful components of Pydantic is the Settings Management. This will allow you to read settings variables from different sources and parse and validate them into class(es) using Pydantic.\nLet\u0026rsquo;s see a minimal example. First we need to set up the variable:\n$ export API_KEY=xxx And then we can read it into the Settings class with:\nfrom pydantic import BaseSettings class Settings(BaseSettings): api_key: str print(Settings().","keywords":["python","pydantic","aws","secrets manager"],"articleBody":"Intro If you are already familiar with Pydantic, one of the useful components of Pydantic is the Settings Management. This will allow you to read settings variables from different sources and parse and validate them into class(es) using Pydantic.\nLet’s see a minimal example. First we need to set up the variable:\n$ export API_KEY=xxx And then we can read it into the Settings class with:\nfrom pydantic import BaseSettings class Settings(BaseSettings): api_key: str print(Settings().dict()) \"\"\" {'api_key': 'xxx'} \"\"\" Different data sources are available to read variables from, currently the options include:\nEnvironment variables Dotenv file Docker secrets But what if you want to add new data sources? For example if you want to read it from a JSON file or AWS Secrets Manager?\nLuckily Pydantic Settings allows you to customize the settings resources easily. Checking here you can add or remove resources or change their priorities.\nSo let’s see how we can add a custom resource to read secrets from AWS Secrets Manager.\nAWS Secrets Manager Note: If you are familiar with AWS Secrets Manager or already have access to an existing one with some secrets defined you can skip to the next section.\nSecrets Manager is a service which allows you to store any sensitive information like database passwords, API Keys, etc and retrieve them in your code without worrying about environment variables or dotenv files being passed around in your source code. Obviously your secrets are encrypted in AWS and decrypted in two steps when you want to retrieve them.\nOn top of this, you also get other benefits like secret rotation, logging and managing permissions based on AWS IAM policies.\nIf you already have an AWS account and credentials you can move to the next step and use the example code, otherwise I will use localstack to create a local version of all AWS services and test this without actually working with an AWS account.\nYou can install localstack easily with:\n$ pip install localstack After it’s installed, you can start localstack to run using Docker:\n$ localstack start -d AWS services should now be available on your local at http://localhost:4566.\nIf you alrady have aws CLI installed, you can try using the localstack with:\n$ export AWS_ACCESS_KEY_ID=\"test\" $ export AWS_SECRET_ACCESS_KEY=\"test\" $ export AWS_DEFAULT_REGION=\"us-east-1\" $ aws --endpoint-url=http://localhost:4566 secretsmanager list-secrets Or you can install awslocal, which is a wrapper around aws CLI and you don’t need to use the --endpoint-url anymore.\n$ pip install awscli-local $ awslocal secretsmanager list-secrets This will probably get you some empty response because we haven’t defined any secrets yet.\nNow let’s try to define two secrets:\n$ awslocal secretsmanager create-secret \\ --name example_secret \\ --secret-string \"SECRET_VALUE\" $ awslocal secretsmanager create-secret \\ --name example_complex \\ --secret-string \"{\\\"user\\\":\\\"diegor\\\",\\\"password\\\":\\\"EXAMPLE-PASSWORD\\\"}\" Next let’s try to list the secrets again with awslocal secretsmanager list-secrets which will give a similiar response to this:\n{ \"SecretList\": [ { \"ARN\": \"arn:aws:secretsmanager:us-east-1:000000000000:secret:example_secret-xxxx\", \"Name\": \"example_secret\", \"LastChangedDate\": xxxxxxxxxxxxxxxxx, \"SecretVersionsToStages\": { \"e49ae6a9-201b-45a8-93ea-a474cf3427cb\": [ \"AWSCURRENT\" ] }, \"CreatedDate\": xxxxxxxxxxxxxxxxx }, { \"ARN\": \"arn:aws:secretsmanager:us-east-1:000000000000:secret:example_complex-xxxx\", \"Name\": \"example_complex\", \"LastChangedDate\": xxxxxxxxxxxxxxxxx, \"SecretVersionsToStages\": { \"87b93858-f03a-431e-8560-2c1ec836945f\": [ \"AWSCURRENT\" ] }, \"CreatedDate\": xxxxxxxxxxxxxxxxx } ] } Now we can move to our implementation code.\nPydantic Settings with Secrets Manager The first step is to connect to the AWS secrets manager service using boto3 and create a client. In case of using localstack you can use the following credentials to connect to it:\nfrom boto3 import Session session = Session( aws_access_key_id=\"test\", aws_secret_access_key=\"test\", region_name=\"us-east-1\", ) client = session.client( endpoint_url=\"http://localhost:4566\", service_name=\"secretsmanager\", region_name=\"us-east-1\", ) Pydantic BaseSettings class can use a nested Config class which does extra configurations for the settings management. Next we define a SecretManagerConfig class which will modify Config’s behaviour:\nimport json from typing import Any from pydantic.env_settings import SettingsSourceCallable class SecretManagerConfig: @classmethod def _get_secret(cls, secret_name: str) -\u003e str | dict[str, Any]: # Get secret string value secret_string = client.get_secret_value(SecretId=secret_name)[\"SecretString\"] try: # try to decode it into a dict if it was JSON encoded return json.loads(secret_string) except json.decoder.JSONDecodeError: return secret_string @classmethod def get_secrets(cls, settings: BaseSettings) -\u003e dict[str, Any]: # We go through the fields and try to fetch a secret with that field name return { name: cls._get_secret(name) for name, _ in settings.__fields__.items() } @classmethod def customise_sources( cls, init_settings: SettingsSourceCallable, env_settings: SettingsSourceCallable, file_secret_settings: SettingsSourceCallable, ): # Here we add the `cls.get_secrets` method as an extra data source return ( init_settings, cls.get_secrets, env_settings, file_secret_settings, ) The method customise_sources is the method that Pydantic Settings allows you to add or delete new data sources. So it’s overriden to add our custom data source get_secrets there.\nIn get_secrets we go through the Settings.__fields__ and get the secret details by using this name. For each secret string returned, we can try to load it into a dict using json.loads in case our secret was JSON encoded.\nAnd we define our settings classes next:\nfrom pydantic import BaseSettings, BaseModel class DatabaseSettings(BaseModel): user: str password: str class Settings(BaseSettings): example_secret: str example_complex: DatabaseSettings class Config(SecretManagerConfig): ... And finally we can load our settings with:\nprint(Settings().dict()) \"\"\" {'example_secret': 'SECRET_VALUE', 'example_complex': {'user': 'diegor', 'password': 'EXAMPLE-PASSWORD'}} \"\"\" This allows us to load both simple key, value secrets and JSON encoded ones into sub-settings which Pydantic handles very nicely.\nObviously this can be improved to handle more cases or even be written in better ways, but this will give you the idea how you can do continue from here.\nThe complete code:\nimport json from typing import Any from boto3 import Session from pydantic import BaseSettings, BaseModel from pydantic.env_settings import SettingsSourceCallable session = Session( aws_access_key_id=\"test\", aws_secret_access_key=\"test\", region_name=\"us-east-1\", ) client = session.client( endpoint_url=\"http://localhost:4566\", service_name=\"secretsmanager\", region_name=\"us-east-1\", ) class SecretManagerConfig: @classmethod def _get_secret(cls, secret_name: str) -\u003e str | dict[str, Any]: secret_string = client.get_secret_value(SecretId=secret_name)[\"SecretString\"] try: return json.loads(secret_string) except json.decoder.JSONDecodeError: return secret_string @classmethod def get_secrets(cls, settings: BaseSettings) -\u003e dict[str, Any]: return { name: cls._get_secret(name) for name, _ in settings.__fields__.items() } @classmethod def customise_sources( cls, init_settings: SettingsSourceCallable, env_settings: SettingsSourceCallable, file_secret_settings: SettingsSourceCallable, ): return ( init_settings, cls.get_secrets, env_settings, file_secret_settings, ) class DatabaseSettings(BaseModel): user: str password: str class Settings(BaseSettings): example_secret: str example_complex: DatabaseSettings class Config(SecretManagerConfig): ... print(Settings().dict()) \"\"\" {'example_secret': 'SECRET_VALUE', 'example_complex': {'user': 'diegor', 'password': 'EXAMPLE-PASSWORD'}} \"\"\" ","wordCount":"1002","inLanguage":"en","datePublished":"2023-01-26T16:53:06+01:00","dateModified":"2023-01-26T16:53:06+01:00","author":{"@type":"Person","name":"Amin"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://aminalaee.dev/posts/2023/pydantic-settings-secret-manager/"},"publisher":{"@type":"Organization","name":"Amin Alaee","logo":{"@type":"ImageObject","url":"https://aminalaee.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://aminalaee.dev accesskey=h title="Amin Alaee (Alt + H)">Amin Alaee</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://aminalaee.dev/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://aminalaee.dev>Home</a>&nbsp;»&nbsp;<a href=https://aminalaee.dev/posts/>Posts</a></div><h1 class=post-title>Pydantic Settings with AWS Secrets Manager</h1><div class=post-meta><span title='2023-01-26 16:53:06 +0100 +0100'>January 26, 2023</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;1002 words&nbsp;·&nbsp;Amin</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#intro aria-label=Intro>Intro</a></li><li><a href=#aws-secrets-manager aria-label="AWS Secrets Manager">AWS Secrets Manager</a></li><li><a href=#pydantic-settings-with-secrets-manager aria-label="Pydantic Settings with Secrets Manager">Pydantic Settings with Secrets Manager</a></li></ul></div></details></div><div class=post-content><h2 id=intro>Intro<a hidden class=anchor aria-hidden=true href=#intro>#</a></h2><p>If you are already familiar with <code>Pydantic</code>, one of the useful components of <code>Pydantic</code> is the <a href=https://docs.pydantic.dev/usage/settings/>Settings Management</a>.
This will allow you to read settings variables from different sources and parse and validate them into class(es) using <code>Pydantic</code>.</p><p>Let&rsquo;s see a minimal example. First we need to set up the variable:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ export API_KEY<span style=color:#f92672>=</span>xxx
</span></span></code></pre></div><p>And then we can read it into the <code>Settings</code> class with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> pydantic <span style=color:#f92672>import</span> BaseSettings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Settings</span>(BaseSettings):
</span></span><span style=display:flex><span>    api_key: str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(Settings()<span style=color:#f92672>.</span>dict())
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{&#39;api_key&#39;: &#39;xxx&#39;}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>Different data sources are available to read variables from, currently the options include:</p><ul><li>Environment variables</li><li>Dotenv file</li><li>Docker secrets</li></ul><p>But what if you want to add new data sources? For example if you want to read it from a JSON file or AWS Secrets Manager?</p><p>Luckily <code>Pydantic</code> Settings allows you to customize the settings resources easily. Checking <a href=https://docs.pydantic.dev/usage/settings/#customise-settings-sources>here</a> you can add or remove resources or change their priorities.</p><p>So let&rsquo;s see how we can add a custom resource to read secrets from AWS Secrets Manager.</p><h2 id=aws-secrets-manager>AWS Secrets Manager<a hidden class=anchor aria-hidden=true href=#aws-secrets-manager>#</a></h2><p><strong>Note</strong>: If you are familiar with AWS Secrets Manager or already have access to an existing one with some secrets defined you can skip to the next section.</p><p>Secrets Manager is a service which allows you to store any sensitive information like database passwords, API Keys, etc and retrieve them in your code without worrying about environment variables or dotenv files being passed around in your source code. Obviously your secrets are encrypted in AWS and decrypted in two steps when you want to retrieve them.</p><p>On top of this, you also get other benefits like secret rotation, logging and managing permissions based on AWS IAM policies.</p><p>If you already have an AWS account and credentials you can move to the next step and use the example code, otherwise I will use <a href=https://github.com/localstack/localstack>localstack</a> to create a local version of all AWS services and test this without actually working with an AWS account.</p><p>You can install <code>localstack</code> easily with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pip install localstack
</span></span></code></pre></div><p>After it&rsquo;s installed, you can start <code>localstack</code> to run using <code>Docker</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ localstack start -d
</span></span></code></pre></div><p>AWS services should now be available on your local at <code>http://localhost:4566</code>.</p><p>If you alrady have <code>aws</code> CLI installed, you can try using the <code>localstack</code> with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ export AWS_ACCESS_KEY_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;test&#34;</span>
</span></span><span style=display:flex><span>$ export AWS_SECRET_ACCESS_KEY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;test&#34;</span>
</span></span><span style=display:flex><span>$ export AWS_DEFAULT_REGION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;us-east-1&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ aws --endpoint-url<span style=color:#f92672>=</span>http://localhost:4566 secretsmanager list-secrets
</span></span></code></pre></div><p>Or you can install <code>awslocal</code>, which is a wrapper around <code>aws</code> CLI and you don&rsquo;t need to use the <code>--endpoint-url</code> anymore.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pip install awscli-local
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ awslocal secretsmanager list-secrets
</span></span></code></pre></div><p>This will probably get you some empty response because we haven&rsquo;t defined any secrets yet.</p><p>Now let&rsquo;s try to define two secrets:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ awslocal secretsmanager create-secret <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --name example_secret <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --secret-string <span style=color:#e6db74>&#34;SECRET_VALUE&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ awslocal secretsmanager create-secret <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --name example_complex <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --secret-string <span style=color:#e6db74>&#34;{\&#34;user\&#34;:\&#34;diegor\&#34;,\&#34;password\&#34;:\&#34;EXAMPLE-PASSWORD\&#34;}&#34;</span>
</span></span></code></pre></div><p>Next let&rsquo;s try to list the secrets again with <code>awslocal secretsmanager list-secrets</code> which will give a similiar response to this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;SecretList&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;ARN&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:secretsmanager:us-east-1:000000000000:secret:example_secret-xxxx&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;Name&#34;</span>: <span style=color:#e6db74>&#34;example_secret&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;LastChangedDate&#34;</span>: xxxxxxxxxxxxxxxxx,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;SecretVersionsToStages&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;e49ae6a9-201b-45a8-93ea-a474cf3427cb&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;AWSCURRENT&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;CreatedDate&#34;</span>: xxxxxxxxxxxxxxxxx
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;ARN&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:secretsmanager:us-east-1:000000000000:secret:example_complex-xxxx&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;Name&#34;</span>: <span style=color:#e6db74>&#34;example_complex&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;LastChangedDate&#34;</span>: xxxxxxxxxxxxxxxxx,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;SecretVersionsToStages&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;87b93858-f03a-431e-8560-2c1ec836945f&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;AWSCURRENT&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;CreatedDate&#34;</span>: xxxxxxxxxxxxxxxxx
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Now we can move to our implementation code.</p><h2 id=pydantic-settings-with-secrets-manager>Pydantic Settings with Secrets Manager<a hidden class=anchor aria-hidden=true href=#pydantic-settings-with-secrets-manager>#</a></h2><p>The first step is to connect to the AWS secrets manager service using <code>boto3</code> and create a client. In case of using <code>localstack</code> you can use the following credentials to connect to it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> boto3 <span style=color:#f92672>import</span> Session
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span> Session(
</span></span><span style=display:flex><span>    aws_access_key_id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;test&#34;</span>,
</span></span><span style=display:flex><span>    aws_secret_access_key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;test&#34;</span>,
</span></span><span style=display:flex><span>    region_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;us-east-1&#34;</span>,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>client <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>client(
</span></span><span style=display:flex><span>    endpoint_url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://localhost:4566&#34;</span>,
</span></span><span style=display:flex><span>    service_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;secretsmanager&#34;</span>,
</span></span><span style=display:flex><span>    region_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;us-east-1&#34;</span>,
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>Pydantic <code>BaseSettings</code> class can use a nested <code>Config</code> class which does extra configurations for the settings management. Next we define a <code>SecretManagerConfig</code> class which will modify <code>Config</code>&rsquo;s behaviour:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Any
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pydantic.env_settings <span style=color:#f92672>import</span> SettingsSourceCallable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecretManagerConfig</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_get_secret</span>(cls, secret_name: str) <span style=color:#f92672>-&gt;</span> str <span style=color:#f92672>|</span> dict[str, Any]:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Get secret string value</span>
</span></span><span style=display:flex><span>        secret_string <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>get_secret_value(SecretId<span style=color:#f92672>=</span>secret_name)[<span style=color:#e6db74>&#34;SecretString&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># try to decode it into a dict if it was JSON encoded</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> json<span style=color:#f92672>.</span>loads(secret_string)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> json<span style=color:#f92672>.</span>decoder<span style=color:#f92672>.</span>JSONDecodeError:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> secret_string
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_secrets</span>(cls, settings: BaseSettings) <span style=color:#f92672>-&gt;</span> dict[str, Any]:
</span></span><span style=display:flex><span>        <span style=color:#75715e># We go through the fields and try to fetch a secret with that field name</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            name: cls<span style=color:#f92672>.</span>_get_secret(name) <span style=color:#66d9ef>for</span> name, _ <span style=color:#f92672>in</span> settings<span style=color:#f92672>.</span>__fields__<span style=color:#f92672>.</span>items()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>customise_sources</span>(
</span></span><span style=display:flex><span>        cls,
</span></span><span style=display:flex><span>        init_settings: SettingsSourceCallable,
</span></span><span style=display:flex><span>        env_settings: SettingsSourceCallable,
</span></span><span style=display:flex><span>        file_secret_settings: SettingsSourceCallable,
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Here we add the `cls.get_secrets` method as an extra data source</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>            init_settings,
</span></span><span style=display:flex><span>            cls<span style=color:#f92672>.</span>get_secrets,
</span></span><span style=display:flex><span>            env_settings,
</span></span><span style=display:flex><span>            file_secret_settings,
</span></span><span style=display:flex><span>        )
</span></span></code></pre></div><p>The method <code>customise_sources</code> is the method that <code>Pydantic</code> Settings allows you to add or delete new data sources. So it&rsquo;s overriden to add our custom data source <code>get_secrets</code> there.</p><p>In <code>get_secrets</code> we go through the <code>Settings.__fields__</code> and get the secret details by using this name. For each secret string returned, we can try to load it into a dict using <code>json.loads</code> in case our secret was JSON encoded.</p><p>And we define our settings classes next:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pydantic <span style=color:#f92672>import</span> BaseSettings, BaseModel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DatabaseSettings</span>(BaseModel):
</span></span><span style=display:flex><span>    user: str
</span></span><span style=display:flex><span>    password: str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Settings</span>(BaseSettings):
</span></span><span style=display:flex><span>    example_secret: str
</span></span><span style=display:flex><span>    example_complex: DatabaseSettings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Config</span>(SecretManagerConfig):
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span></code></pre></div><p>And finally we can load our settings with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>print(Settings()<span style=color:#f92672>.</span>dict())
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{&#39;example_secret&#39;: &#39;SECRET_VALUE&#39;, &#39;example_complex&#39;: {&#39;user&#39;: &#39;diegor&#39;, &#39;password&#39;: &#39;EXAMPLE-PASSWORD&#39;}}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>This allows us to load both simple key, value secrets and JSON encoded ones into sub-settings which <code>Pydantic</code> handles very nicely.</p><p>Obviously this can be improved to handle more cases or even be written in better ways, but this will give you the idea how you can do continue from here.</p><p>The complete code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Any
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> boto3 <span style=color:#f92672>import</span> Session
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pydantic <span style=color:#f92672>import</span> BaseSettings, BaseModel
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pydantic.env_settings <span style=color:#f92672>import</span> SettingsSourceCallable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span> Session(
</span></span><span style=display:flex><span>    aws_access_key_id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;test&#34;</span>,
</span></span><span style=display:flex><span>    aws_secret_access_key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;test&#34;</span>,
</span></span><span style=display:flex><span>    region_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;us-east-1&#34;</span>,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>client <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>client(
</span></span><span style=display:flex><span>    endpoint_url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://localhost:4566&#34;</span>,
</span></span><span style=display:flex><span>    service_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;secretsmanager&#34;</span>,
</span></span><span style=display:flex><span>    region_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;us-east-1&#34;</span>,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecretManagerConfig</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_get_secret</span>(cls, secret_name: str) <span style=color:#f92672>-&gt;</span> str <span style=color:#f92672>|</span> dict[str, Any]:
</span></span><span style=display:flex><span>        secret_string <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>get_secret_value(SecretId<span style=color:#f92672>=</span>secret_name)[<span style=color:#e6db74>&#34;SecretString&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> json<span style=color:#f92672>.</span>loads(secret_string)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> json<span style=color:#f92672>.</span>decoder<span style=color:#f92672>.</span>JSONDecodeError:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> secret_string
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_secrets</span>(cls, settings: BaseSettings) <span style=color:#f92672>-&gt;</span> dict[str, Any]:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            name: cls<span style=color:#f92672>.</span>_get_secret(name) <span style=color:#66d9ef>for</span> name, _ <span style=color:#f92672>in</span> settings<span style=color:#f92672>.</span>__fields__<span style=color:#f92672>.</span>items()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>customise_sources</span>(
</span></span><span style=display:flex><span>        cls,
</span></span><span style=display:flex><span>        init_settings: SettingsSourceCallable,
</span></span><span style=display:flex><span>        env_settings: SettingsSourceCallable,
</span></span><span style=display:flex><span>        file_secret_settings: SettingsSourceCallable,
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>            init_settings,
</span></span><span style=display:flex><span>            cls<span style=color:#f92672>.</span>get_secrets,
</span></span><span style=display:flex><span>            env_settings,
</span></span><span style=display:flex><span>            file_secret_settings,
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DatabaseSettings</span>(BaseModel):
</span></span><span style=display:flex><span>    user: str
</span></span><span style=display:flex><span>    password: str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Settings</span>(BaseSettings):
</span></span><span style=display:flex><span>    example_secret: str
</span></span><span style=display:flex><span>    example_complex: DatabaseSettings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Config</span>(SecretManagerConfig):
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(Settings()<span style=color:#f92672>.</span>dict())
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{&#39;example_secret&#39;: &#39;SECRET_VALUE&#39;, &#39;example_complex&#39;: {&#39;user&#39;: &#39;diegor&#39;, &#39;password&#39;: &#39;EXAMPLE-PASSWORD&#39;}}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://aminalaee.dev/tags/python/>python</a></li><li><a href=https://aminalaee.dev/tags/pydantic/>pydantic</a></li><li><a href=https://aminalaee.dev/tags/aws/>aws</a></li><li><a href=https://aminalaee.dev/tags/secrets-manager/>secrets manager</a></li></ul><nav class=paginav><a class=prev href=https://aminalaee.dev/posts/2023/python-requests-persistent-connections/><span class=title>« Prev</span><br><span>Python requests Connection Pool</span></a>
<a class=next href=https://aminalaee.dev/posts/2022/fastapi-aws-lambda/><span class=title>Next »</span><br><span>FastAPI AWS Lambda deployment</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Pydantic Settings with AWS Secrets Manager on twitter" href="https://twitter.com/intent/tweet/?text=Pydantic%20Settings%20with%20AWS%20Secrets%20Manager&url=https%3a%2f%2faminalaee.dev%2fposts%2f2023%2fpydantic-settings-secret-manager%2f&hashtags=python%2cpydantic%2caws%2csecretsmanager"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Pydantic Settings with AWS Secrets Manager on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2faminalaee.dev%2fposts%2f2023%2fpydantic-settings-secret-manager%2f&title=Pydantic%20Settings%20with%20AWS%20Secrets%20Manager&summary=Pydantic%20Settings%20with%20AWS%20Secrets%20Manager&source=https%3a%2f%2faminalaee.dev%2fposts%2f2023%2fpydantic-settings-secret-manager%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Pydantic Settings with AWS Secrets Manager on reddit" href="https://reddit.com/submit?url=https%3a%2f%2faminalaee.dev%2fposts%2f2023%2fpydantic-settings-secret-manager%2f&title=Pydantic%20Settings%20with%20AWS%20Secrets%20Manager"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Pydantic Settings with AWS Secrets Manager on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2faminalaee.dev%2fposts%2f2023%2fpydantic-settings-secret-manager%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Pydantic Settings with AWS Secrets Manager on whatsapp" href="https://api.whatsapp.com/send?text=Pydantic%20Settings%20with%20AWS%20Secrets%20Manager%20-%20https%3a%2f%2faminalaee.dev%2fposts%2f2023%2fpydantic-settings-secret-manager%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Pydantic Settings with AWS Secrets Manager on telegram" href="https://telegram.me/share/url?text=Pydantic%20Settings%20with%20AWS%20Secrets%20Manager&url=https%3a%2f%2faminalaee.dev%2fposts%2f2023%2fpydantic-settings-secret-manager%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://aminalaee.dev>Amin Alaee</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>